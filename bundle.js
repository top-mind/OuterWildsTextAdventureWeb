"use strict";(()=>{var I={};function m(...s){console.log(...s)}function E(s){I[s]=loadJSON(s)}function lt(s){I[s]=loadSound(s)}function ut(s){if(s in I)return new J(I[s]);throw new Error(`JSON object was not preloaded! Path: ${s}`)}function ht(s,e){throw new Error("Method not implemented.")}function et(){window.location.reload()}var z=class{loadFile(e){if(e in I){let t=I[e];return new $e(t)}else throw new Error(`Audio file was not preloaded! Path: ${e}`)}},$e=class{constructor(e){this._sound=e}play(){this._sound.play()}pause(){this._sound.pause()}},W=class{constructor(e=[]){this._data=e}size(){return this._data.length}getJSONObject(e){let t=this._data[e];return typeof t=="object"&&!(t instanceof J)?new J(t):t}getString(e){return this._data[e]}toJSON(e){return this._data}},J=class s{constructor(e={}){this._data=e}hasKey(e){return e in this._data}getFloat(e,t){let o=this._data[e];return o==null?t:typeof o=="number"?o:Number(o)}getInt(e,t){let o=this._data[e];return o==null?t:typeof o=="number"?o:Number(o)}getString(e,t){let o=this._data[e];return o==null?t:typeof o=="string"?o:JSON.stringify(o)}getBoolean(e,t){let o=this._data[e];return o==null?t:typeof o=="boolean"?o:!!o}getJSONArray(e){let t=this._data[e];return Array.isArray(t)&&!(t instanceof W)?new W(t):e in this._data?t:null}getJSONObject(e){let t=this._data[e];return typeof t=="object"&&!(t instanceof s)?new s(t):e in this._data?t:null}setFloat(e,t){return this._data[e]=t,this}setInt(e,t){return this._data[e]=t,this}setString(e,t){return this._data[e]=t,this}setBoolean(e,t){return this._data[e]=t,this}setJSONArray(e,t){return this._data[e]=t,this}setJSONObject(e,t){return this._data[e]=t,this}keys(){return Object.keys(this._data)}toJSON(e){return this._data}};var F=class s{static loadSounds(){m("Sounds loading..."),s.kazooTheme=tt.loadFile("data/audio/ow_kazoo_theme.mp3")}},k=class s{constructor(){F.loadSounds()}static play(e){s.currentSound=e,s.currentSound.play()}static pause(){s.currentSound!=null?s.currentSound.pause():m("Current sound is NULL!!!")}};var H=(o=>(o[o.BEACON=0]="BEACON",o[o.QUANTUM=1]="QUANTUM",o[o.TRAVELER=2]="TRAVELER",o))(H||{});var h=class s{constructor(e,t){this.x=e instanceof s?e.x:typeof e=="number"?e:0,this.y=e instanceof s?e.y:typeof t=="number"?t:0}assign(e){this.x=e.x,this.y=e.y}toString(){return"("+this.x+", "+this.y+")"}dist(e){return e.sub(this).magnitude()}add(e){return new s(this.x+e.x,this.y+e.y)}sub(e){return new s(this.x-e.x,this.y-e.y)}mult(e){return new s(this.x*e,this.y*e)}scale(e){return this.x*=e,this.y*=e,this}magnitude(){return Math.max(Math.sqrt(this.x*this.x+this.y*this.y),.001)}normalize(){let e=this.magnitude();return this.x/=e,this.y/=e,this}normalized(){let e=this.magnitude();return new s(this.x/e,this.y/e)}theta(){return Math.atan2(this.y,this.x)}dx(){return this.x/this.magnitude()}dy(){return this.y/this.magnitude()}leftNormal(){return new s(this.y,-this.x)}rightNormal(){return new s(-this.y,this.x)}dot(e){return this.x*e.x+this.y*e.y}scaledDot(e){return this.x*e.dx()+this.y*e.dy()}projectOnto(e){let t=this.scaledDot(e);return new s(t*e.dx(),t*e.dy())}};var b=class{constructor(e,t){this.parent=null;let o=new h;typeof e=="number"&&typeof t=="number"?o=new h(e,t):e instanceof h&&(o=e),this.position=new h,this.screenPosition=new h,this._children=[],this.setPosition(o)}setPosition(e,t){this.position.x=e instanceof h?e.x:e,this.position.y=e instanceof h?e.y:t??0,this.parent!=null?this.updateScreenPosition(this.parent.screenPosition):this.updateScreenPosition(new h(0,0))}updateScreenPosition(e){this.screenPosition.assign(e.add(this.position));for(let t=0;t<this._children.length;t++)this._children[t].updateScreenPosition(this.screenPosition)}setScreenPosition(e){this.parent==null?this.setPosition(e):this.setPosition(e.sub(this.parent.screenPosition))}draw(){}render(){this.draw()}addChild(e){this._children.includes(e)||(this._children.push(e),e.parent=this,e.updateScreenPosition(this.screenPosition))}removeChild(e){this._children.includes(e)&&this._children.splice(this._children.indexOf(e),1),e.parent=null}},U=class s extends b{constructor(){super(new h(0,0));this.currentSector=null;this.lastSector=null;this.currentNode=null;this._moveTowardsTarget=!1;this._distToTarget=0;this._targetScreenPos=new h,this._offset=new h(0,0)}static{this.SPEED=10}isDead(){return!1}update(){if(this._offset.y=0,(this.currentNode==null||!this.currentNode.gravity)&&(this._offset.y=Math.sin(millis()*.005)*5),this._moveTowardsTarget){let t=this._targetScreenPos.sub(this.screenPosition);this._distToTarget=t.magnitude();let o=Math.min(this._distToTarget,s.SPEED);this.setScreenPosition(this.screenPosition.add(t.normalize().mult(o)))}}draw(){fill(0,0,100),ellipse(this.screenPosition.x,this.screenPosition.y,10,10)}setNode(t){this.currentNode=t,this._targetScreenPos.assign(t.screenPosition),this.setScreenPosition(t.screenPosition)}moveToScreenPosition(t){this._targetScreenPos.assign(t),this._moveTowardsTarget=!0}moveToNode(t){this.currentNode=t,this._targetScreenPos.assign(t.screenPosition),this._moveTowardsTarget=!0}},Q=class extends U{setNode(e){super.setNode(e),e.visit()}moveToNode(e){super.moveToNode(e),e.visit()}update(){super.update()}draw(){this.drawAt(this.screenPosition.x,this.screenPosition.y+this._offset.y,1)}drawAt(e,t,o){stroke(30,100,100),fill(0,0,0),push(),translate(e,t),scale(o),ellipse(0,0,10,20),pop()}},Y=class extends U{constructor(e){super(),this._player=e}update(){super.update()}draw(){this.drawAt(this.screenPosition.x,this.screenPosition.y+this._offset.y,1,!1)}drawAt(e,t,o,r){stroke(30,100,100),fill(0,0,0),this._player.currentNode==this.currentNode&&!r&&fill(30,100,100),push(),translate(e,t),scale(o),triangle(-20,15,20,15,0,-20),pop()}},K=class extends U{isDead(){return this._distToTarget<.1}update(){super.update()}draw(){noStroke(),fill(30,100,100),push(),translate(this.screenPosition.x,this.screenPosition.y),ellipse(0,0,10,10),pop()}};var l=class extends b{constructor(t,o=0,r=0,a=150,p=50){super(new h(o,r));this.hoverState=!1;this.visible=!0;this.enabled=!0;this._buttonDown=!1;this._wasMousePressed=!1;this._buttonColor=color(0,0,100);this._hasDisabledPrompt=!1;this.id=this._disabledPrompt=t,this._bounds=new h(a,p)}setColor(t){this._buttonColor=t}setDisabledPrompt(t){this._disabledPrompt=t,this._hasDisabledPrompt=!0}getWidth(){return this._bounds.x}setObserver(t){this._observer=t}update(){if(!this.enabled){this._buttonDown=!1,this.hoverState=!1;return}this.isPointInBounds(mouseX,mouseY)?(this.hoverState||(this.hoverState=!0,this.onButtonEnterHover(),this._observer.onButtonEnterHover(this)),!this._wasMousePressed&&this.mousePressed()&&(this._buttonDown=!0),this._buttonDown&&!this.mousePressed()&&(this._buttonDown=!1,this.onButtonUp(),this._observer.onButtonUp(this))):(this._buttonDown=!1,this.hoverState&&(this.hoverState=!1,this.onButtonExitHover(),this._observer.onButtonExitHover(this))),this._wasMousePressed=this.mousePressed()}onButtonExitHover(){}onButtonEnterHover(){}onButtonUp(){}mousePressed(){return mouseIsPressed}draw(){if(!this.visible)return;let t=100;this.enabled||(t=25),stroke(hue(this._buttonColor),saturation(this._buttonColor),brightness(this._buttonColor),t),fill(0,0,0),this.hoverState&&(this._buttonDown?stroke(0,100,100):stroke(200,100,100)),this.drawShape(),this.drawText(t)}drawShape(){rectMode(CENTER),rect(this.screenPosition.x,this.screenPosition.y,this._bounds.x,this._bounds.y)}drawText(t){fill(0,0,100,t),textSize(14),textFont(P),textAlign(CENTER,CENTER),this.enabled?text(this.id,this.screenPosition.x,this.screenPosition.y):text(this._disabledPrompt,this.screenPosition.x,this.screenPosition.y)}isPointInBounds(t,o){return t>this.screenPosition.x-this._bounds.x*.5&&t<this.screenPosition.x+this._bounds.x*.5&&o>this.screenPosition.y-this._bounds.y*.5&&o<this.screenPosition.y+this._bounds.y*.5}};var g=class{constructor(){this.active=!1;this.overlay=!1;this._buttons=new Array,this._toolbarButtons=new Array,this._starPositions=new Array(1e3);for(let e=0;e<this._starPositions.length;e++)this._starPositions[e]=new h(random(0,width),random(90,height-90));this._toolbarRoot=new b(width/2,height-50)}addButton(e){this._buttons.push(e),e.setObserver(this)}removeButton(e){this._buttons.includes(e)&&this._buttons.splice(this._buttons.indexOf(e),1)}addButtonToToolbar(e){this.addButton(e),this._toolbarButtons.push(e),this._toolbarRoot.addChild(e),this.updateToolbarPositions()}removeButtonFromToolbar(e){this.removeButton(e),this._toolbarButtons.splice(this._toolbarButtons.indexOf(e),1),this._toolbarRoot.removeChild(e),this.updateToolbarPositions()}updateToolbarPositions(){let t=-10;for(let r=0;r<this._toolbarButtons.length;r++)t+=10,t+=this._toolbarButtons[r].getWidth();let o=-(t*.5);for(let r=0;r<this._toolbarButtons.length;r++){let a=this._toolbarButtons[r].getWidth()*.5;o+=a,this._toolbarButtons[r].setPosition(o,0),o+=a+10}}onEnter(){}onExit(){}onButtonUp(e){}onButtonEnterHover(e){}onButtonExitHover(e){}updateInput(){for(let e=0;e<this._buttons.length;e++)this._buttons[e].update()}renderBackground(){let e=color(0,0,0),t=color(0,0,100);c.isPlayerAtEOTU()&&(e=color(0,0,100),t=color(0,0,0)),background(e),noStroke();for(let o=0;o<this._starPositions.length;o++)fill(t),rectMode(CENTER),rect(this._starPositions[o].x,this._starPositions[o].y,2,2)}renderButtons(){if(this.active)for(let e=0;e<this._buttons.length;e++)this._buttons[e].render()}};var A=class s{constructor(){this.cache=new Map}static getInstance(){return s.instance||(s.instance=new s),s.instance}async translate(e){let t=this.cache.get(e);if(t)return t;try{let o=await fetch("https://api-edge.cognitive.microsofttranslator.com/translate?api-version=3.0&from=en&to=zh-Hans",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${await this.getToken()}`},body:JSON.stringify([{text:e}])});if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);let a=(await o.json())[0].translations[0].text;return console.log("\u539F\u6587:",e),console.log("\u8BD1\u6587:",a),this.cache.set(e,a),a}catch(o){return console.error("\u7FFB\u8BD1\u5931\u8D25:",o),"\u7FFB\u8BD1\u5931\u8D25"}}async getToken(){try{let e=await fetch("https://edge.microsoft.com/translate/auth");if(!e.ok)throw new Error("\u83B7\u53D6 token \u5931\u8D25");return await e.text()}catch(e){throw console.error("\u83B7\u53D6 token \u5931\u8D25:",e),e}}};var X=class extends g{constructor(){super(),this.addButtonToToolbar(new l("Close Database",0,0,150,50)),this._clueRoot=new b(100,140);for(let e=0;e<c.getClueCount();e++){let t=new ot(c.getClueAt(e),e*40,this);this.addButton(t),this._clueRoot.addChild(t)}}setObserver(e){this._observer=e}onEnter(){}onExit(){this._observer=null}onClueMouseOver(e){this._activeClue=e}onClueSelected(e){this._observer!=null?this._observer.onInvokeClue(e):n.publish("that doesn't help you right now",!0)}onButtonUp(e){e.id=="Close Database"&&i.popScreen()}update(){}async render(){fill(0,0,0),stroke(0,0,100),rectMode(CORNER);let e=width/2-100,t=200,o=500,r=300;rect(e,t,o,r);let a="Select An Entry";this._activeClue!=null?a=this._activeClue.description:c.getKnownClueCount()==0&&(a="No Entries Yet"),textFont(S),textSize(18),textAlign(LEFT,TOP),fill(0,0,100),textFont("SimSun");let p=this._activeClue.description,B=await A.getInstance().translate(p),L=p+`
[\u8BD1: `+B+"]";text(L,e+10,t+10,o-20,r-20),n.render()}},ot=class extends l{constructor(e,t,o){super(e.name,(textWidth(e.name)+10)*.5,t,textWidth(e.name)+10,20),this._clue=e,this._clueObserver=o}getClue(){return this._clue}update(){this.enabled=this._clue.discovered,this.visible=this._clue.discovered,super.update()}draw(){if(!this.visible)return;super.draw();let e;this._clue.curiosity==0?e=color(100,100,100):this._clue.curiosity==3?e=color(200,100,100):this._clue.curiosity==1?e=color(20,100,100):e=color(300,100,100),fill(e),noStroke(),ellipse(this.screenPosition.x-this._bounds.x*.5-20,this.screenPosition.y,10,10),noFill(),stroke(e),ellipse(this.screenPosition.x-this._bounds.x*.5-20,this.screenPosition.y,15,15)}onButtonEnterHover(){this._clueObserver.onClueMouseOver(this._clue)}onButtonUp(){this._clueObserver.onClueSelected(this._clue)}};var Z=class{constructor(){this._observers=new Array}addObserver(e){this._observers.includes(e)||this._observers.push(e)}removeObserver(e){this._observers.splice(this._observers.indexOf(e),1)}removeAllObservers(){this._observers.length=0}sendMessage(e){let t=e instanceof C?e:new C(e);for(let o=0;o<this._observers.length;o++)this._observers[o].onReceiveGlobalMessage(t)}},C=class{constructor(e,t){this.id=e,t!==void 0&&(this.text=t)}};var $=class{constructor(){this._knownClueCount=0;this._isDead=!1;this._knowsLaunchCodes=ct,this._knowsSignalCoordinates=mt,this._clueList=new Array,this._knownFrequencies=new Array,this._knownFrequencies.push(2),pt&&(this._knownFrequencies.push(0),this._knownFrequencies.push(1)),this._clueList.push(new y(3,"APL_1","Sunken Module","The data-collection module broke off from the Nomai probe launcher and fell into the center of Giant's Deep.")),this._clueList.push(new y(3,"APL_2","Rogue Tornadoes","While most tornadoes on Giant's Deep have upward-moving winds, the tornadoes that rotate counterclockwise have strong downward winds.")),this._clueList.push(new y(3,"APL_3","Jellyfish","The jellyfish on Giant's Deep have a hollow body cavity just big enough to fit a person.")),this._clueList.push(new y(2,"QM_3","The 5th Location","The Quantum Moon sometimes visits a 5th location outside the Solar System.")),this._clueList.push(new y(2,"QM_1","Quantum Snapshot","Observing an image of a quantum object prevents it from moving just as effectively as directly observing the object itself.")),this._clueList.push(new y(2,"QM_2","Quantum Entanglement",`Ordinary objects in close proximity to a quantum object can become 'entangled' with it and begin to exhibit quantum attributes.

Even lifeforms can become entangled so long as they are unable to observe themselves or their surroundings.`)),this._clueList.push(new y(0,"D_1","Lost Vessel","The Nomai came to this Solar System in search of a mysterious signal they refer to as 'The Eye of the Universe'. The interstellar Vessel they traveled in is shipwrecked somewhere in Dark Bramble.")),this._clueList.push(new y(0,"D_2","Children's Game","Nomai children played a game that reenacted their people's escape from Dark Bramble. According to the rules, three players (the escape pods) had to sneak past a blindfolded player (the anglerfish) without being heard.")),this._clueList.push(new y(0,"D_3","Tracking Device","The Nomai Vessel crashed in the roots of Dark Bramble. The Nomai attempted to relocate the roots by inserting a tracking device into one of Dark Bramble's vines, but they were unable to penetrate the vine's tough exterior.")),this._clueList.push(new y(1,"TLD_1","Time Machine","After Nomai researchers created a small-but-functional time loop device on Giant's Deep, they made plans to construct a full-sized version on the Sandy Hourglass Twin (provided they could generate enough energy to power it).")),this._clueList.push(new y(1,"TLD_2","Warp Towers","The Nomai created special towers that can warp anyone inside to a corresponding receiver platform. The towers only activate when you can see your destination through a slit in the top of the tower.")),this._clueList.push(new y(1,"TLD_3","Construction Project",`The Nomai excavated the Sandy Hourglass Twin to construct an enormous machine designed to harness the energy from a supernova.

The control center is located inside a hollow cavity at the center of the planet, but it is completely sealed off from the surface.

`))}init(){u.addObserver(this),this._isDead=!1}onReceiveGlobalMessage(e){e.id==="learn launch codes"&&!this._knowsLaunchCodes?(this._knowsLaunchCodes=!0,n.publish("learned launch codes",!0),u.sendMessage("spawn ship")):e.id==="learn signal coordinates"&&!this._knowsSignalCoordinates&&(this._knowsSignalCoordinates=!0,n.publish("learned signal coordinates",!0)),N.saveData(this)}killPlayer(){this._isDead=!0,N.saveData(this)}isPlayerDead(){return this._isDead}isPlayerAtEOTU(){return d.player.currentSector==i._solarSystem.quantumMoon&&d.getQuantumMoonLocation()==4||d.player.currentSector==i._solarSystem.eyeOfTheUniverse}knowsFrequency(e){return this._knownFrequencies.includes(e)}knowsSignalCoordinates(){return this._knowsSignalCoordinates}learnFrequency(e){this.knowsFrequency(e)||(this._knownFrequencies.push(e),n.publish("frequency identified: "+ee(e),!0)),N.saveData(this)}getFrequencyCount(){return this._knownFrequencies.length}knowsLaunchCodes(){return this._knowsLaunchCodes}getClueAt(e){return this._clueList[e]}getClueCount(){return this._clueList.length}getKnownClueCount(){return this._knownClueCount}discoverClue(e){for(let t=0;t<this._clueList.length;t++)this._clueList[t].id===e&&!this._clueList[t].discovered&&(this._clueList[t].discovered=!0,this._knownClueCount++,n.publish("information added to database",!0));N.saveData(this)}},y=class{constructor(e,t,o,r){this.invoked=!1;this.curiosity=e,this.id=t,this.name=o,this.description=r,this.discovered=dt}};var N=class{static{this.PLAYER_DATA="playerData"}static saveData(e){localStorage.setItem(this.PLAYER_DATA,JSON.stringify(e))}static loadData(){let e=new $;if(!this.hasData())return e;let t=JSON.parse(localStorage.getItem(this.PLAYER_DATA));return Object.assign(e,t),e}static clearData(){localStorage.removeItem(this.PLAYER_DATA)}static hasData(){return!!localStorage.getItem(this.PLAYER_DATA)}};var te=class extends g{constructor(){super(),N.hasData()?(this.addTitleButton("Continue",110),this.addTitleButton("Reset Progress",-110)):this.addTitleButton("New Game",0)}addTitleButton(e,t){this.addButton(new l(e,width/2+t,height-50,200,50))}onEnter(){if(gt){i.loadSector(3);return}k.play(F.kazooTheme)}onExit(){k.pause()}update(){}render(){fill(142,90,90),textAlign(CENTER,CENTER),textSize(100),text("Outer Wilds",width/2,height/2-50),fill(0,0,100),textSize(22),text("a thrilling graphical text adventure",width/2,height/2+50)}onButtonUp(e){e.id=="New Game"||e.id=="Continue"?i.loadSector(3):e.id=="Reset Progress"&&(N.clearData(),et())}},oe=class extends g{constructor(){super(),this.addButton(new l("Exit",width/2,height-50,200,50))}onEnter(){k.play(F.kazooTheme)}onExit(){k.pause()}update(){}render(){fill(142,90,90),textAlign(CENTER,CENTER),textSize(100),text("Outer Wilds",width/2,height/2-50),fill(0,0,100),textSize(22),text("thanks for playing!",width/2,height/2+50)}onButtonUp(e){e.id=="Exit"&&et()}};var x=class s extends g{static{this.BOX_WIDTH=700}static{this.BOX_HEIGHT=400}constructor(){super(),this.overlay=!0,this.initButtons()}initButtons(){this.addButtonToToolbar(this._nextButton=new l("Continue",0,0,150,50))}addDatabaseButton(){this.addButtonToToolbar(this._databaseButton=new l("Use Database",0,0,150,50))}addContinueButton(){this.addButtonToToolbar(this._nextButton=new l("Continue",0,0,150,50))}update(){}renderBackground(){}async render(){push(),translate(width/2-s.BOX_WIDTH/2,height/2-s.BOX_HEIGHT/2),stroke(0,0,100),fill(0,0,0),rectMode(CORNER),rect(0,0,s.BOX_WIDTH,s.BOX_HEIGHT),fill(0,0,100),textFont(S),textSize(18),textAlign(LEFT,TOP),textFont("SimSun");let e=this.getDisplayText(),t=await A.getInstance().translate(e),o=e+`
[\u8BD1: `+t+"]";text(o,10,10,s.BOX_WIDTH-20,s.BOX_HEIGHT-20),pop(),n.render(),_.renderTimer()}onButtonUp(e){e==this._nextButton?this.onContinue():e==this._databaseButton&&(i.pushScreen(i.databaseScreen),i.databaseScreen.setObserver(this))}onInvokeClue(e){}onEnter(){}onExit(){}},se=class extends x{onEnter(){n.clear(),n.publish("you are eaten by an anglerfish",!0)}getDisplayText(){return`As you fly towards the shining light, you realize it's actually the lure of a huge anglerfish!

You try to turn around, but it's too late - the anglerfish devours you in a single bite.

The world goes black...`}onContinue(){c.killPlayer()}},ie=class extends x{onEnter(){n.clear(),n.publish("you try to dive underwater",!0)}getDisplayText(){return"You try to dive underwater, but a strong surface current prevents you from submerging more than a few hundred meters."}onContinue(){i.popScreen()}},ne=class extends x{constructor(e,t){super(),this._text=e,this._destination=t}onExit(){n.clear(),n.publish("you are teleported to a new location",!0)}getDisplayText(){return this._text}onContinue(){i.popScreen(),u.sendMessage(new C("teleport to",this._destination))}},re=class extends x{constructor(e,t){super(),this._text=e,this._destination=t}getDisplayText(){return this._text}onContinue(){i.popScreen(),u.sendMessage(new C("move to",this._destination))}},ae=class extends x{constructor(e,t){super(),this._arrivalText=e,this._sectorName=t}onEnter(){n.clear(),n.publish("you arrive at "+this._sectorName)}getDisplayText(){return this._arrivalText}onContinue(){i.popScreen()}},le=class extends x{constructor(){super(...arguments);this._screenIndex=0;this._photoTaken=!1}initButtons(){this.addDatabaseButton(),this.addContinueButton()}getDisplayText(){return this._screenIndex==0?this._photoTaken?"You use your probe to take a snapshot of the moon mere moments before it's utterly obscured by the encroaching mist.":"As you approach the Quantum Moon, a strange mist starts to obscure your vision...":this._screenIndex==1?this._photoTaken?`You plunge into the mist, making sure to keep an eye on the photo you took just moments before.

Suddenly a huge shape materializes out of the mist...you've made it to the surface of the Quantum Moon!`:`The mist completely engulfs your ship, then dissipates as suddenly as it appeared.

You scan your surroundings, but the Quantum Moon has mysteriously vanished.`:""}onInvokeClue(t){t.id==="QM_1"?(i.popScreen(),this._photoTaken=!0,this._databaseButton.enabled=!1):n.publish("that doesn't help you right now",!0)}onContinue(){this._screenIndex++,this._databaseButton.enabled=!1,this._screenIndex>1&&(this._photoTaken?i.popScreen():(i.popScreen(),u.sendMessage("quantum moon vanished")))}},ue=class extends x{constructor(){super(),d.player.currentSector.getName()==="Quantum Moon"?this._displayText=`You turn off your flashlight and the world becomes pitch black.

When you turn the flashlight back on, your surroundings have changed...`:this._displayText=`You climb on top of the quantum rock and turn off your flashlight. It's so dark you can't even see your hand in front of your face.

When you turn the flashlight back on, you're still standing on top of the quantum rock, but your surrounding have changed...`}onEnter(){n.clear(),n.publish("you become entangled with the quantum object")}getDisplayText(){return this._displayText}onContinue(){i.popScreen()}},he=class extends x{constructor(){super(...arguments);this._screenIndex=0;this._silentRunning=!1}initButtons(){this.addDatabaseButton(),this.addContinueButton()}getDisplayText(){return this._screenIndex==0?`You launch your probe at one of the strangely-bluish flowers and it is promptly ingested. You follow your probe's tracking signal as the vine's vascular system carries it deep into the heart of Dark Bramble.

You're so focused on following the probe's signal, you don't notice the glowing lures until it's too late. You've flown straight into a nest of anglerfish!`:this._screenIndex==1?this._silentRunning?`Suddenly remembering the rules to an ancient children's game, you switch off your engines and silently drift into the nest.

None of the anglerfish seem to notice, and you safely reach the other side. You resume following the probe's signal, and it's not long before you reach an ancient derelict tangled in the roots of Dark Bramble.`:"You reverse your thrusters, but it's too late. The anglerfish lunge with terrifying speed and devour your spacecraft whole.":""}onButtonUp(t){t==this._nextButton?this.onContinue():t==this._databaseButton&&(i.pushScreen(i.databaseScreen),i.databaseScreen.setObserver(this))}onInvokeClue(t){t.id==="D_2"?(i.popScreen(),this._silentRunning=!0,this._screenIndex++,this._databaseButton.enabled=!1):n.publish("that doesn't help you right now",!0)}onContinue(){this._screenIndex++,this._databaseButton.enabled=!1,this._screenIndex>1&&(this._silentRunning?(i.popScreen(),u.sendMessage(new C("move to","Ancient Vessel"))):(i.popScreen(),c.killPlayer()))}},ce=class extends x{constructor(){super(),this._displayText=`You explore the derelict and eventually find the bridge. Although the ship's life support systems are dead, a few computer terminals are still running on some sort of auxiliary power. You find records of the original signal the Nomai received from the Eye of the Universe. According to their analysis, whatever the signal came from must be older than the Universe itself!

You poke around a bit more and discover that the ship's warp drive finished recharging a few hundred years ago.`}initButtons(){this.addButtonToToolbar(this._warpButton=new l("Use Warp Drive",0,0,150,50)),super.initButtons()}getDisplayText(){return this._displayText}onButtonUp(e){e==this._warpButton?c.knowsSignalCoordinates()?_.getEnabled()?this._displayText="You input the coordinates to the Eye of the Universe and try to use the warp drive, but it refuses to activate due to the presence of a 'massive temporal distortion'.":(i.popScreen(),u.sendMessage(new C("teleport to","Ancient Vessel 2")),n.clear(),n.publish("the ancient vessel warps to the coordinates of the Eye of the Universe")):this._displayText="You try to use the warp drive, but apparently it won't activate without destination coordinates.":e==this._nextButton&&this.onContinue()}onContinue(){i.popScreen()}},de=class extends x{constructor(){super(...arguments);this._screenIndex=0}initButtons(){this.addContinueButton()}getDisplayText(){return this._screenIndex==0?`You're inside a huge spherical chamber at the center of the sandy Hourglass Twin. The two giant antennae you saw outside extend below the surface and converge within an elaborate coil-like piece of Nomai technology at the center of the chamber. This must be the source of the time loop!

You discover a transmitter that automatically tells the Nomai space station in orbit around Giant's Deep to launch a probe at the start of each loop.

The time loop machine requires the energy from a supernova to alter the flow of time. The Nomai tried to artificially make the sun go supernova thousands of years ago, but their attempts were unsuccessful.`:`You eventually find a way to the center of the chamber and find what looks like the interface to the Time Loop Machine.

Do you want to disable the time loop?`}onButtonUp(t){super.onButtonUp(t),t==this._yes?(u.sendMessage("disable time loop"),i.popScreen()):t==this._no&&i.popScreen()}onContinue(){this._screenIndex++,this.removeButtonFromToolbar(this._nextButton),this.addButtonToToolbar(this._yes=new l("Yes")),this.addButtonToToolbar(this._no=new l("No"))}},pe=class extends x{constructor(){super(...arguments);this._screenIndex=0}getDisplayText(){return this._screenIndex==0?`As you apprach the strange energy cloud surrounding the Eye of the Universe, you see the last few stars die in the distance. The Universe has become a pitch black void of nothingness.

The cloud dissipates as you reach its center, revealing a strange spherical object floating in space. Beneath its shimmering surface you see billions of tiny lights. As you get closer, you realize these lights resemble clusters of stars and galaxies. Every time you look away from the sphere and back again, the configuration of stars and galaxies changes.

You fire your jetpack thrusters and move into the sphere itself...`:`For the briefest moment you find yourself floating in a sea of stars and galaxies. Suddenly all of the stars collapse into a single point of light directly in front of you. Nothing happens for several seconds, then the point of light explodes outwards in a spectacular burst of energy. The shockwave slams into you and sends you careening away into space.

Your life-support systems are failing, but you watch as energy and matter are spewed into space in all directions.

After a while, your vision fades to black.`}onContinue(){this._screenIndex++,this._screenIndex==2&&(i._solarSystem.player.currentSector=null,i.pushScreen(new oe))}},me=class extends x{constructor(){super(...arguments);this._screenIndex=0}initButtons(){this.addDatabaseButton(),this.addButtonToToolbar(this._yes=new l("Yes")),this.addButtonToToolbar(this._no=new l("No"))}getDisplayText(){return this._screenIndex==0?`You explore the outer perimeter of Dark Bramble, where the tips of its thorny vines end in massive alien-looking white flowers (along with a few bluish ones).

You notice a small opening near the center of each flower...do you want to move in for a closer look?`:`As you approach, the flower opens and a strange force starts to pull you in. You desperately try to escape, but it's no use.

You are unceremoniously devoured by a giant space flower. You can hear yourself being digested as the world goes black...`}onButtonUp(t){super.onButtonUp(t),t==this._yes?(this._screenIndex++,this.removeButtonFromToolbar(this._yes),this.removeButtonFromToolbar(this._no),this.removeButtonFromToolbar(this._databaseButton),this.addContinueButton()):t==this._no&&i.popScreen()}onInvokeClue(t){t.id==="D_3"?(i.popScreen(),u.sendMessage("follow the vine")):n.publish("that doesn't help you right now",!0)}onContinue(){c.killPlayer()}};var _e=class{constructor(){this._skipRender=!1;this._screenStack=new Array}lateUpdate(){}runGameLoop(){if(this._screenStack.length>0){this._skipRender=!1;let e=this._screenStack[this._screenStack.length-1];if(e.updateInput(),e.update(),this.lateUpdate(),this._skipRender)return;let t=0;for(let o=this._screenStack.length-1;o>=0;o--)if(!this._screenStack[o].overlay){t=o;break}for(let o=t;o<this._screenStack.length;o++)this._screenStack[o].renderBackground(),this._screenStack[o].renderButtons(),this._screenStack[o].render()}else m("No screens on the stack!!!")}swapScreen(e){this._screenStack.length>0&&(this._screenStack[this._screenStack.length-1].onExit(),this._screenStack[this._screenStack.length-1].active=!1,this._screenStack.splice(this._screenStack.length-1,1)),this._screenStack.push(e),this._screenStack[this._screenStack.length-1].active=!0,this._screenStack[this._screenStack.length-1].onEnter(),this._skipRender=!0,m("SWAP:",e)}pushScreen(e){this._screenStack.length>0&&(this._screenStack[this._screenStack.length-1].onExit(),this._screenStack[this._screenStack.length-1].active=!1),this._screenStack.push(e),e.active=!0,e.onEnter(),this._skipRender=!0,m("PUSH:",e)}popScreen(){this._screenStack[this._screenStack.length-1].onExit(),this._screenStack[this._screenStack.length-1].active=!1,this._screenStack.splice(this._screenStack.length-1,1),this._screenStack.length>0&&(this._screenStack[this._screenStack.length-1].active=!0,this._screenStack[this._screenStack.length-1].onEnter()),this._skipRender=!0,m("POP")}};var ge=class{constructor(e,t){this._node=e,this._nodeObj=t}parseJSON(){this._exploreString=this._nodeObj.getString("explore","Nothing to see here!"),this._exploreArray=new W,this._exploreString.charAt(0)=="{"?this._activeExploreObj=this._nodeObj.getJSONObject("explore"):this._exploreString.charAt(0)=="["&&(this._exploreArray=this._nodeObj.getJSONArray("explore"),this._activeExploreObj=this._exploreArray.getJSONObject(0)),this._dirty=!0}updateActiveExploreData(){for(let e=0;e<this._exploreArray.size();e++){let t=this._exploreArray.getJSONObject(e),o=t.getInt("turn cycle",1),r=_.getActionPoints()%o;t.getInt("on turn",-1)==r&&t!=this._activeExploreObj&&(this._activeExploreObj=t,this._dirty=!0)}}canClueBeInvoked(e){if(e==="QM_2"&&this._node.allowQuantumEntanglement())return!0;for(let t=0;t<this._exploreArray.size();t++){let o=this._exploreArray.getJSONObject(t);if(o.getString("require clue","")===e&&o!=this._activeExploreObj||o.hasKey("clue event")&&o.getJSONObject("clue event").getString("clue id")===e)return!0}return!1}invokeClue(e){e==="QM_2"&&this._node.allowQuantumEntanglement()&&(i.popScreen(),u.sendMessage("quantum entanglement"));for(let t=0;t<this._exploreArray.size();t++){let o=this._exploreArray.getJSONObject(t);if(o.getString("require clue","")===e&&o!=this._activeExploreObj&&(this._activeExploreObj=o,this._dirty=!0),o.hasKey("clue event")&&o.getJSONObject("clue event").getString("clue id")===e){let a=o.getJSONObject("clue event").getString("event id");u.sendMessage(a)}}}explore(){this.updateActiveExploreData(),this._dirty&&this._activeExploreObj!=null&&(this.fireEvents(this._activeExploreObj),this.discoverClues(this._activeExploreObj),this.revealHiddenPaths(this._activeExploreObj),this._dirty=!1)}fireEvents(e){e.hasKey("fire event")&&u.sendMessage(e.getString("fire event")),e.hasKey("move to")&&i.swapScreen(new re(e.getString("text"),e.getString("move to"))),e.hasKey("teleport to")&&i.swapScreen(new ne(e.getString("text"),e.getString("teleport to")))}discoverClues(e){e.hasKey("discover clue")&&c.discoverClue(e.getString("discover clue"))}revealHiddenPaths(e){if(e.hasKey("reveal paths")){let t=e.getJSONArray("reveal paths");for(let o=0;o<t.size();o++)this._node.getConnection(t.getString(o)).revealHidden();n.publish("you discover a hidden path!",!0)}}getExploreText(){return this._activeExploreObj!=null?this._activeExploreObj.getString("text","no explore text"):this._exploreString}};var M=class extends l{constructor(t){super("Switch Frequency",width/2+140,40,50,50);this._rightFacing=!0;this._rightFacing=t,t||this.setScreenPosition(new h(width/2-140,40))}drawShape(){push(),translate(this.screenPosition.x,this.screenPosition.y),this._rightFacing?triangle(25,0,0,15,0,-15):triangle(-25,0,0,15,0,-15),pop()}drawText(t){}},fe=class{constructor(){this._frequency=2}update(e){this._signalStrength=0;for(let t=0;t<e.length;t++)this._signalStrength+=e[t].getSignalStrength(new h(mouseX,mouseY),this._frequency)}render(){let e=ee(this._frequency);c.knowsFrequency(this._frequency)||(this._frequency==0?e="Unknown Frequency 001":this._frequency==1&&(e="Unknown Frequency 002"));let t=width/2;fill(0,0,100),textSize(18),textFont(S),text(e,t,40),textFont(P),stroke(0,0,100),fill(200,100,100),rectMode(CENTER),rect(t,70,max(0,this._signalStrength*300-random(50)),7),noFill(),stroke(0,0,100),line(mouseX,0,mouseX,height),line(0,mouseY,width,mouseY)}nextFrequency(){let e=(this._frequency+1)%this.getFrequencyValues().length;this._frequency=this.getFrequencyValues()[e]}previousFrequency(){let e=this._frequency-1;e<0&&(e=this.getFrequencyValues().length-1),this._frequency=this.getFrequencyValues()[e]}getFrequencyValues(){return Object.values(H).filter(e=>typeof e=="number")}},w=class extends b{constructor(e,t){super(),e instanceof f?(this.setScreenPosition(e.screenPosition),this._signals=new Array,this._signals.push(e.getSignal())):(this.setScreenPosition(e),this._signals=t.getSectorSignals())}addSignal(e){this._signals.push(e)}getSignalStrength(e,t){if(this.hasSignalWithFrequency(t)){let r=e.sub(this.screenPosition).magnitude(),a=max(0,1-r/150);return a*a*a}return 0}hasSignalWithFrequency(e){for(let t=0;t<this._signals.length;t++)if(this._signals[t].frequency==e)return!0;return!1}},be=class{constructor(e){this.frequency=0;e==="QUANTUM"?this.frequency=1:e==="BEACON"?this.frequency=0:e==="TRAVELER"&&(this.frequency=2)}};var f=class s extends b{constructor(t,o){super(typeof t=="number"?t:0,typeof o=="number"?o:0);this._id="";this._name="";this.entryPoint=!1;this.shipAccess=!1;this.allowTelescope=!0;this.gravity=!0;this._signal=null;this._visible=!1;this._visited=!1;this._explored=!1;this._inRange=!1;this._button=null;this._observer=null;this._nodeJSONObj=null;this._exploreData=null;this._connections=new Map,this._observers=new Array,u.addObserver(this),typeof t=="string"&&typeof o!="number"&&(this._id=t,this._name=t,this.loadJSON(o),this.entryPoint&&(this._visible=!0),this._button=new l(this._id,0,0,this.getSize()*1.5,this.getSize()*1.5),this._button.setObserver(this),this._button.visible=!1,this.addChild(this._button))}loadJSON(t){this._nodeJSONObj=t,this._name=this._nodeJSONObj.getString("name",this._id),t.hasKey("explore")&&(this._exploreData=new ge(this,t)),this.position.x=this._nodeJSONObj.getJSONObject("position").getFloat("x"),this.position.y=this._nodeJSONObj.getJSONObject("position").getFloat("y"),this._visible=this._nodeJSONObj.getBoolean("start visible",this._visible),R&&(this._visible=!0),this.entryPoint=this._nodeJSONObj.getBoolean("entry point",this.entryPoint),this.shipAccess=this.entryPoint||this._nodeJSONObj.getBoolean("ship access",this.shipAccess),this.allowTelescope=this._nodeJSONObj.getBoolean("allow telescope",this.allowTelescope),this.gravity=this._nodeJSONObj.getBoolean("gravity",this.gravity),this._nodeJSONObj.hasKey("signal")&&(this._signal=new be(this._nodeJSONObj.getString("signal")))}savePosition(){this._nodeJSONObj.getJSONObject("position").setFloat("x",this.position.x),this._nodeJSONObj.getJSONObject("position").setFloat("y",this.position.y),m(this._id+" position saved:",this.position)}onReceiveGlobalMessage(t){}isExplorable(){return this._nodeJSONObj!=null&&this._nodeJSONObj.hasKey("explore")}getExploreData(){return this._exploreData}getProbeDescription(){return this._nodeJSONObj.hasKey("probe description")?this._nodeJSONObj.getString("probe description"):this.getDescription()}getDescription(){return this._nodeJSONObj.getString("description","a vast expanse of nothing")}hasDescription(){return this._nodeJSONObj!=null&&this._nodeJSONObj.hasKey("description")}isProbeable(){return this._nodeJSONObj!=null&&this._nodeJSONObj.hasKey("description")}isConnectedTo(t){return this._connections.has(t)}inRange(){return this._inRange}updateInRange(t,o){this._inRange=!1,o==this&&(this._inRange=!0),this.entryPoint&&t&&(this._inRange=!0),o!=null&&this.isConnectedTo(o)&&(this._inRange=!0)}getConnection(t){if(t instanceof s)return this._connections.get(t);for(let o of this._connections.keys())if(o.getID()===t)return this.getConnection(o);return null}allowQuantumEntanglement(){return this._nodeJSONObj==null?!1:this._nodeJSONObj.getBoolean("entanglement node",!1)}getSignal(){return this._signal}getID(){return this._id}getActualName(){return this._name}getKnownName(){return this._visited?this.getActualName():"???"}setVisible(t){this._visible=t}visit(){this._visited=!0,this.setVisible(!0),this._nodeJSONObj!=null&&this._nodeJSONObj.hasKey("fire event")&&u.sendMessage(this._nodeJSONObj.getString("fire event"));for(let t of this._connections.values())t.reveal();this._observer!=null&&this._observer.onNodeVisited(this)}explore(){this._explored=!0,this._exploreData.explore(),this._signal!=null&&c.learnFrequency(this._signal.frequency)}update(){this._visible&&(this._button.enabled=this.inRange()||R,this._button.update())}getAlpha(){return this.inRange()?100:35}getSize(){return this.entryPoint?50:this.isExplorable()?35:25}draw(){if(this._visible){if(this._button.hoverState?stroke(200,100,100,this.getAlpha()):stroke(0,0,100,this.getAlpha()),push(),translate(this.screenPosition.x,this.screenPosition.y),!this.isExplorable()){fill(0,0,0),ellipse(0,0,this.getSize(),this.getSize()),pop();return}this.entryPoint?(fill(0,0,0),ellipse(0,0,this.getSize(),this.getSize())):(fill(0,0,0),rect(0,0,this.getSize(),this.getSize())),this._explored||(fill(0,0,100,this.getAlpha()),textAlign(CENTER,CENTER),textSize(30),text("?",0,0)),pop()}}drawName(){if(!this._visible||!this.isExplorable())return;let t=new h(this.screenPosition.x,this.screenPosition.y-this.getSize()/2-20);noStroke(),fill(0,0,0),textSize(st),rect(t.x,t.y,textWidth(this.getKnownName()),st+4),fill(0,0,100,this.getAlpha()),textAlign(CENTER,CENTER),text(this.getKnownName(),t.x,t.y)}addConnection(t){if([...this._connections.values()].includes(t)){m("These nodes are already connected!!!");return}t.node1!=this?this._connections.set(t.node1,t):this._connections.set(t.node2,t)}setNodeObserver(t){this._observer=t}addObserver(t){this._observers.push(t)}removeAllObservers(){this._observers.length=0}onButtonUp(t){for(let o=0;o<this._observers.length;o++)this._observers[o].onNodeSelected(this)}onButtonEnterHover(t){for(let o=0;o<this._observers.length;o++)this._observers[o].onNodeGainFocus(this)}onButtonExitHover(t){for(let o=0;o<this._observers.length;o++)this._observers[o].onNodeLoseFocus(this)}};var ve=class{constructor(e,t,o){this._hasDescription=!1;this._adjacentToPlayer=!1;this._traversed=!1;this._visible=!1;this._gated=!1;this._oneWay=!1;this._hidden=!1;this.node1=e,this.node2=t,this._connectionObj=o,this.node1.addConnection(this),this.node2.addConnection(this),this._oneWay=o.getBoolean("one-way",this._oneWay),this._hidden=o.getBoolean("hidden",this._hidden),this._gated=o.getBoolean("gated",this._gated),R&&(this._visible=!0),o.hasKey("description")&&(this._hasDescription=!0,this._description=o.getString("description"))}updateAdjacentToPlayer(e){this._adjacentToPlayer=!1,(this.node1==e||this.node2==e)&&(this._adjacentToPlayer=!0)}hasDescription(){return this._hasDescription}getDescription(){return this._description}getWrongWayText(){return"looks like this path is only traversible from the other direction"}getOtherNode(e){return e==this.node1?this.node2:this.node1}traversibleFrom(e){return!this._gated&&(!this._oneWay||e==this.node1)}fireTraverseEvent(){this._connectionObj.hasKey("traverse event")&&u.sendMessage(this._connectionObj.getString("traverse event"))}fireFailEvent(){this._connectionObj.hasKey("fail event")&&u.sendMessage(this._connectionObj.getString("fail event"))}traverse(){this._traversed=!0}revealHidden(){this._hidden=!1,this.reveal()}setVisible(e){this._visible=e}reveal(){this._hidden||(this.node1.setVisible(!0),this.node2.setVisible(!0),this._visible=!0)}getAlpha(){return this._adjacentToPlayer?100:35}render(){if(!this._visible)return;let e=this.node2.screenPosition.sub(this.node1.screenPosition),t=e.magnitude();if(e.normalize(),this._traversed)stroke(0,0,100,this.getAlpha()),line(this.node1.screenPosition.x,this.node1.screenPosition.y,this.node2.screenPosition.x,this.node2.screenPosition.y);else{stroke(0,0,100,this.getAlpha());let B=0,L=5;for(;B<t;){let v=this.node1.screenPosition.add(e.mult(B)),T=this.node1.screenPosition.add(e.mult(B+L));line(v.x,v.y,T.x,T.y),B+=L*3}}if(!this._oneWay)return;let o=this.node1.screenPosition.add(e.mult(t*.6)),r=o.sub(e.mult(14)),a=r.add(e.rightNormal().scale(7)),p=r.add(e.leftNormal().scale(7));fill(0,0,0),triangle(a.x,a.y,p.x,p.y,o.x,o.y)}};var O=class{constructor(){this._name="unnamed";this._skipArrivalScreen=!1;this.defaultActorPosition=new h(width-100,height-100);this._sectorRoot=new b(width/2,height/2),this._actors=new Array,this._nodes=new Array,this._nodeConnections=new Array,this.orbitNode=new f(80,170),this.orbitNode.gravity=!1,u.addObserver(this)}setAnchorOffset(e,t){this._sectorRoot.setPosition(width/2+e,height/2+t)}loadFromJSON(e){this._JSONFilename=e,this._sectorJSON=ut(e);let t=this._sectorJSON.getJSONObject("Nodes");for(let r of t.keys())this.addNode(this.createNode(r,t.getJSONObject(r)));let o=this._sectorJSON.getJSONArray("Connections");for(let r=0;r<o.size();r++){let a=o.getJSONObject(r),p=this.getNode(a.getString("Node 1")),B=this.getNode(a.getString("Node 2"));this._nodeConnections.push(new ve(p,B,a))}}createNode(e,t){return new f(e,t)}saveSectorJSON(){ht(this._sectorJSON,"data/"+this._JSONFilename),m("Sector JSON saved")}load(){}drawSectorBackdrop(){}onReceiveGlobalMessage(e){e.id==="quantum entanglement"&&this.onQuantumEntanglement()}onNodeVisited(e){this.updateNodeRanges(i._solarSystem.isPlayerInShip(),e)}onArrival(){!this._skipArrivalScreen&&this._sectorJSON.hasKey("Sector Arrival")&&(this._skipArrivalScreen=!0,i.pushScreen(new ae(this._sectorJSON.getJSONObject("Sector Arrival").getString("text"),this.getName())))}onQuantumEntanglement(){if(d.player.currentSector==this){i.pushScreen(new ue);for(let e=0;e<this._nodes.length;e++)if(this._nodes[e].allowQuantumEntanglement()&&this._nodes[e]!=d.player.currentNode){d.player.setNode(this._nodes[e]);break}}}canClueBeInvoked(e){return!1}invokeClue(e){}updateNodeRanges(e,t){for(let o=0;o<this._nodes.length;o++)this._nodes[o].updateInRange(e,t);for(let o=0;o<this._nodeConnections.length;o++)this._nodeConnections[o].updateAdjacentToPlayer(t)}allowTelescope(){return!0}getName(){return this._name}getNode(e){if(typeof e=="number")return this._nodes[e]?this._nodes[e]:(m("No nodes at index "+e),null);for(let t=0;t<this._nodes.length;t++)if(this._nodes[t].getID()===e)return this._nodes[t];return null}getSectorSignalSources(){let e=new Array;for(let t=0;t<this._nodes.length;t++)this._nodes[t].getSignal()!=null&&e.push(new w(this._nodes[t]));return e}getSectorSignals(){let e=new Array;for(let t=0;t<this._nodes.length;t++)this._nodes[t].getSignal()!=null&&e.push(this._nodes[t].getSignal());return e}addNodeButtonObserver(e){for(let t=0;t<this._nodes.length;t++)this._nodes[t].addObserver(e)}removeAllNodeButtonObservers(){for(let e=0;e<this._nodes.length;e++)this._nodes[e].removeAllObservers()}update(){for(let e=0;e<this._nodes.length;e++)this._nodes[e].update();for(let e=0;e<this._actors.length;e++)this._actors[e].update(),this._actors[e].isDead()&&this.removeActor(this._actors[e])}renderBackground(){push(),translate(this._sectorRoot.position.x,this._sectorRoot.position.y),this.drawSectorBackdrop(),pop(),fill(0,0,0),noStroke(),rectMode(CORNER),rect(0,0,width,90),rect(0,height-90,width,90),rectMode(CENTER)}render(){for(let e=0;e<this._nodeConnections.length;e++)this._nodeConnections[e].render();for(let e=0;e<this._nodes.length;e++)this._nodes[e].render();for(let e=0;e<this._actors.length;e++)this._actors[e].render();for(let e=0;e<this._nodes.length;e++)this._nodes[e].drawName()}addNode(e){this._nodes.includes(e)?m("Node is already in this Sector!!!"):(this._nodes.push(e),e.setNodeObserver(this),this._sectorRoot.addChild(e))}removeNode(e){this._nodes.includes(e)?(this._nodes.splice(this._nodes.indexOf(e),1),e.setNodeObserver(null),this._sectorRoot.removeChild(e)):m("Node is not in this Sector!!!")}addActor(e,t){let o=(t instanceof f?t:this.getNode(t))??null;this._actors.includes(e)?m("Actor is already in this Sector!!!"):(e.currentSector=this,this._actors.push(e),this._sectorRoot.addChild(e),o!=null?e.setNode(o):(e.setScreenPosition(this.orbitNode.screenPosition.sub(new h(200,0))),e.moveToNode(this.orbitNode)))}removeActor(e){this._actors.includes(e)?(e.currentNode=null,e.currentSector=null,e.lastSector=this,this._actors.splice(this._actors.indexOf(e),1),this._sectorRoot.removeChild(e)):m("Actor is not in this Sector!!!")}};var j=class s extends g{static{this.BOX_WIDTH=700}static{this.BOX_HEIGHT=400}constructor(e){super(),this._exploreData=e.getExploreData(),this.overlay=!0,this.addButtonToToolbar(this._databaseButton=new l("Use Database",0,0,150,50)),this.addButtonToToolbar(this._waitButton=new l("Wait [1 min]",0,0,150,50)),this.addButtonToToolbar(this._backButton=new l("Continue",0,0,150,50)),this._exploreData.parseJSON()}update(){}renderBackground(){}async render(){push(),translate(width/2-s.BOX_WIDTH/2,height/2-s.BOX_HEIGHT/2),stroke(0,0,100),fill(0,0,0),rectMode(CORNER),rect(0,0,s.BOX_WIDTH,s.BOX_HEIGHT),fill(0,0,100),textFont(S),textSize(18),textAlign(LEFT,TOP),textFont("SimSun");let e=this._exploreData.getExploreText(),t=await A.getInstance().translate(e),o=e+`
[\u8BD1: `+t+"]";text(o,10,10,s.BOX_WIDTH-20,s.BOX_HEIGHT-10),pop(),n.render(),_.renderTimer()}onEnter(){}onExit(){}onInvokeClue(e){this._exploreData.canClueBeInvoked(e.id)?(i.popScreen(),this._exploreData.invokeClue(e.id),this._exploreData.explore()):d.player.currentSector!=null&&d.player.currentSector.canClueBeInvoked(e)?(i.popScreen(),d.player.currentSector.invokeClue(e)):n.publish("that doesn't help you right now",!0)}onButtonUp(e){e==this._databaseButton?(i.pushScreen(i.databaseScreen),i.databaseScreen.setObserver(this)):e==this._backButton?i.popScreen():e==this._waitButton&&(_.waitFor(1),this._exploreData.explore())}onButtonEnterHover(e){}onButtonExitHover(e){}};var q=class{constructor(){this._prompt="";this._mouseButton=LEFT}setObserver(e){this._observer=e}getMouseButton(){return this._mouseButton}setMouseButton(e){this._mouseButton=e}getCost(){return 0}getPrompt(){return this._prompt}setPrompt(e){this._mouseButton==LEFT?this._prompt+="L-Clk - "+e:this._prompt+="R-Clk - "+e,this._prompt+=" ["+this.getCost()+" min]"}},Se=class extends q{constructor(e,t,o,r){super(),this._player=t,this._location=o,this.setMouseButton(e),this.setObserver(r),this.setPrompt("probe")}execute(){n.publish("you see "+this._location.getProbeDescription());let e=new K;this._player.currentSector.addActor(e),e.setScreenPosition(this._player.screenPosition),e.moveToNode(this._location),this._observer.onProbeNode(this._location)}},ye=class extends q{constructor(e,t,o){super(),this._location=t,this.setMouseButton(e),this.setObserver(o),this.setPrompt("explore")}getCost(){return 1}execute(){_.spendActionPoints(this.getCost()),_.getActionPoints()!=0&&(n.clear(),n.publish("you explore the "+this._location.getActualName()),this._observer.onExploreNode(this._location),i.pushScreen(new j(this._location)),this._location.explore())}},V=class extends q{constructor(e,t,o,r,a){super(),this._ship=o,this._player=t,this._destination=r,this.setMouseButton(e),this.setObserver(a),this.setPrompt()}setPrompt(e){if(e!==void 0)return super.setPrompt(e);if(this._ship!=null){if(this._ship.currentNode==null&&this._destination.gravity){this.setPrompt("land here");return}this.setPrompt("fly here")}else this._destination.gravity?this.setPrompt("hike here"):this.setPrompt("jetpack here")}getCost(){return 1}execute(){if(n.clear(),this._player.currentNode!=null){let e=this._destination.getConnection(this._player.currentNode);if(e!=null){if(!e.traversibleFrom(this._player.currentNode)){e.fireFailEvent(),n.publish(e.getWrongWayText(),!0);return}e.fireTraverseEvent(),e.traverse(),e.hasDescription()&&n.publish("you traverse "+e.getDescription())}}this._destination.hasDescription()&&n.publish("you reach "+this._destination.getDescription()),this._ship!=null&&this._ship.moveToNode(this._destination),u.sendMessage("reset reachability"),this._player.moveToNode(this._destination),this._observer.onTravelAttempt(!0,this._destination,this._destination.getConnection(this._player.currentNode)),_.spendActionPoints(this.getCost())}};var xe=class{constructor(e){this._dragging=!1;this._activeSector=e,this._saveButton=new l("Save",width-75,height-50,100,50),this._saveButton.setObserver(this)}update(){this._saveButton.update(),this._selection!=null&&(this._dragging&&(this._selection.setScreenPosition(new h(mouseX,mouseY)),mouseIsPressed||(this._selection.savePosition(),this._selection=null,this._dragging=!1)),this._dragging=mouseIsPressed&&mouseButton==CENTER)}render(){this._saveButton.render()}onButtonUp(e){e==this._saveButton&&this._activeSector.saveSectorJSON()}onNodeGainFocus(e){this._selection=e}onNodeLoseFocus(e){this._dragging||(this._selection=null)}onTravelToNode(e){}onExploreNode(e){}onProbeNode(e){}onButtonEnterHover(e){}onButtonExitHover(e){}onNodeSelected(e){}};var Oe=class extends g{constructor(t,o,r){super();this._actionlessPrompt="inaccessible";this._actions=new Array,this._editor=new xe(t),this._player=o,this._ship=r,this._sector=t,this.addButtonToToolbar(this._databaseButton=new l("Use Database",0,0,150,50)),this.addButtonToToolbar(this._telescopeButton=new l("Scan for Signals",0,0,150,50)),this._telescopeButton.setDisabledPrompt(`Scan for Signals
(view obstructed)`),this.addButtonToToolbar(this._waitButton=new l("Wait [1 min]",0,0,150,50)),this.addButtonToToolbar(this._liftoffButton=new l("Leave Sector",0,0,150,50)),this._liftoffButton.setDisabledPrompt(`Leave Sector
(must be at ship)`)}onEnter(){this._sector.addNodeButtonObserver(this),this._sector.addNodeButtonObserver(this._editor),this._sector.updateNodeRanges(this.isPlayerInShip(),this._player.currentNode),this._focusNode=null}onExit(){this._sector.removeAllNodeButtonObservers()}onButtonUp(t){t==this._databaseButton?(i.databaseScreen.setObserver(this),i.pushScreen(i.databaseScreen)):t==this._liftoffButton?(this._sector.removeActor(this._player),this._sector.removeActor(this._ship),i.loadSolarSystemMap(),n.clear(),n.publish("you leave "+this._sector.getName())):t==this._telescopeButton?i.loadTelescopeView():t==this._waitButton&&_.waitFor(1)}onInvokeClue(t){if(this._player.currentNode!=null&&this._player.currentNode.isExplorable()){let o=this._player.currentNode.getExploreData();if(o.parseJSON(),o.canClueBeInvoked(t.id)){i.popScreen(),i.pushScreen(new j(this._player.currentNode)),o.invokeClue(t.id),o.explore();return}}this._player.currentSector!=null&&this._player.currentSector.canClueBeInvoked(t)?this._player.currentSector.invokeClue(t):n.publish("that doesn't help you right now",!0)}update(){this._liftoffButton.enabled=this._player.currentNode==this._ship.currentNode,this._telescopeButton.enabled=this._player.currentNode!=null&&this._player.currentNode.allowTelescope&&this._player.currentSector.allowTelescope(),this._sector.update(),R&&this._editor.update()}renderBackground(){super.renderBackground(),this._sector.renderBackground()}render(){this._sector.render(),n.render(),_.renderTimer(),fill(0,0,100),textSize(18),textFont(S),textAlign(RIGHT),text(this._sector.getName(),width-20,height-100),this.active&&(R&&this._editor.render(),this.drawNodeGUI(this._focusNode,this._actions))}drawNodeGUI(t,o){if(t==null||this._actions.length==0&&t==this._player.currentNode)return;it();let r=60,a=textWidth(this._actionlessPrompt);for(let p=0;p<o.length;p++)a=max(a,textWidth(o[p].getPrompt()));stroke(200,100,100),fill(0,0,0),rectMode(CORNER),rect(t.screenPosition.x-a*.5-10,t.screenPosition.y+r-15,a+15,max(20,20*o.length)+10),fill(0,0,100),textAlign(LEFT,CENTER);for(let p=0;p<o.length;p++)text(o[p].getPrompt(),t.screenPosition.x-a*.5,t.screenPosition.y+r+20*p);o.length==0&&text(this._actionlessPrompt,t.screenPosition.x-a*.5,t.screenPosition.y+r)}onTravelAttempt(t,o,r){}onExploreNode(t){}onProbeNode(t){}onNodeSelected(t){for(let o=0;o<this._actions.length;o++)if(this._actions[o].getMouseButton()==mouseButton){this._actions[o].execute();break}this.refreshAvailableActions()}onNodeGainFocus(t){this._focusNode=t,this.refreshAvailableActions()}onNodeLoseFocus(t){t==this._focusNode&&(this._focusNode=null,this.refreshAvailableActions())}refreshAvailableActions(){this._actions.length=0,this._focusNode!=null&&(this._player.currentNode!=this._focusNode?this._focusNode.inRange()&&(this._focusNode.isProbeable()&&this._actions.push(new Se(RIGHT,this._player,this._focusNode,this)),this.isPlayerInShip()&&this._focusNode.shipAccess?this._actions.push(new V(LEFT,this._player,this._ship,this._focusNode,this)):this._actions.push(new V(LEFT,this._player,null,this._focusNode,this))):this._focusNode.isExplorable()&&this._actions.push(new ye(LEFT,this._focusNode,this)))}isPlayerInShip(){return this._player.currentNode==this._ship.currentNode}};var Ne=class extends g{constructor(e,t){super(),this._sector=e,this._telescope=t,this._signalSources=e.getSectorSignalSources(),this.addButton(this._nextFrequency=new M(!0)),this.addButton(this._previousFrequency=new M(!1)),this.addButtonToToolbar(this._zoomOutButton=new l("Zoom Out",0,0,150,50)),this.addButtonToToolbar(this._exitButton=new l("Exit",0,0,150,50))}onEnter(){noCursor()}onExit(){cursor(HAND)}update(){this._telescope.update(this._signalSources)}renderBackground(){super.renderBackground(),this._sector.renderBackground()}render(){this._sector.render(),this._telescope.render()}onButtonUp(e){e==this._exitButton?(i.popScreen(),i.popScreen()):e==this._zoomOutButton?i.popScreen():e==this._nextFrequency?this._telescope.nextFrequency():e==this._previousFrequency&&this._telescope.previousFrequency()}};var we=class extends f{constructor(e,t){super(e,t),this.entryPoint=!0,this.shipAccess=!0,this.gravity=!1,this._visible=!0}getKnownName(){return this._visited?"Anglerfish":"???"}getDescription(){return"an enormous hungry-looking anglerfish"}getProbeDescription(){return"a light shining through the fog"}hasDescription(){return!0}isProbeable(){return!0}isExplorable(){return!0}visit(){this._visited=!0,this.setVisible(!0),u.sendMessage("death by anglerfish"),this._observer!=null&&this._observer.onNodeVisited(this)}};var Be=class extends f{constructor(e,t){super(e,t)}updateQuantumStatus(e){let t=this._nodeJSONObj.getInt("quantum location")==e;if(this.setVisible(t),!t)for(let o of this._connections.values())o.setVisible(t)}allowQuantumEntanglement(){return this._nodeJSONObj.getInt("quantum location")==d.getQuantumMoonLocation()&&this._nodeJSONObj.getBoolean("entanglement node",!1)}};var Te=class extends O{load(){this._name="the Comet",this.loadFromJSON("data/sectors/comet.json")}drawSectorBackdrop(){stroke(200,30,100),fill(0,0,0),ellipse(0,0,300,300)}},Ee=class extends O{load(){this._name="the rocky Hourglass Twin",this.loadFromJSON("data/sectors/rocky_twin.json")}drawSectorBackdrop(){stroke(60,100,100),fill(0,0,0),ellipse(0,0,500,500)}},Pe=class extends O{load(){this._name="the sandy Hourglass Twin",this.loadFromJSON("data/sectors/sandy_twin.json")}drawSectorBackdrop(){stroke(60,100,100),fill(0,0,0),ellipse(0,0,500,500)}},Ae=class extends O{load(){this._name="Timber Hearth",this.loadFromJSON("data/sectors/timber_hearth.json")}drawSectorBackdrop(){stroke(200,100,100),fill(0,0,0),ellipse(0,0,500,500)}},ke=class extends O{load(){this._name="Brittle Hollow",this.loadFromJSON("data/sectors/brittle_hollow.json")}drawSectorBackdrop(){stroke(0,100,100),fill(0,0,0),ellipse(0,0,500,500),this.drawBlackHole(35)}drawBlackHole(e){noStroke(),fill(0,100,0),ellipse(0,0,e*.5,e*.5),noFill(),strokeWeight(1),stroke(260,80,70);let t=e*.125,o=e,r=3,a=.1*PI,p=t,B=0;for(let L=a;L<r*TWO_PI;L+=a){let v=L,T=v/(r*TWO_PI)*(o-t)+t,rt=T*cos(v),at=T*sin(v);v-=a/3,T=v/(r*TWO_PI)*(o-t)+t;let vt=T*cos(v),St=T*sin(v);v-=a/3,T=v/(r*TWO_PI)*(o-t)+t;let yt=T*cos(v),xt=T*sin(v);bezier(p,B,yt,xt,vt,St,rt,at),p=rt,B=at}}},Ce=class extends O{load(){this._name="Giant's Deep",this.loadFromJSON("data/sectors/giants_deep.json"),this.setAnchorOffset(0,60)}drawSectorBackdrop(){fill(0,0,0),stroke(180,100,100),ellipse(0,0,600,600),stroke(200,100,60),ellipse(0,0,400,400)}},De=class extends O{constructor(){super(),this._fogLightNodes=new Array,this._fogLightPositions=new Array}load(){this._name="Dark Bramble",this.loadFromJSON("data/sectors/dark_bramble.json");for(let e=0;e<this._fogLightNodes.length;e++){let t=int(random(0,this._fogLightPositions.length));this._fogLightNodes[e].setPosition(this._fogLightPositions[t]),this._fogLightPositions.splice(t,1)}}createNode(e,t){let o;return t.hasKey("anglerfish")?(o=new we(e,t),this._fogLightNodes.push(o),this._fogLightPositions.push(new h(o.position))):o=new f(e,t),t.getBoolean("fog light",!1)&&(this._fogLightNodes.push(o),this._fogLightPositions.push(new h(o.position))),o}drawSectorBackdrop(){stroke(120,100,100),fill(0,0,0),ellipse(100,0,700,500)}},Le=class extends O{constructor(){super(...arguments);this._quantumLocation=0;this._turnsSinceEOTU=0}load(){this._name="Quantum Moon",this.loadFromJSON("data/sectors/quantum_moon.json")}onReceiveGlobalMessage(t){t.id==="quantum entanglement"&&d.player.currentSector==this&&(this.collapse(),this.onQuantumEntanglement())}onArrival(){i.pushScreen(new le)}createNode(t,o){return new Be(t,o)}collapse(){let t=this._quantumLocation;for(;t==this._quantumLocation;)t=int(random(5));this._quantumLocation=t,this._quantumLocation!=4&&(this._turnsSinceEOTU++,this._turnsSinceEOTU>4&&(this._quantumLocation=4,this._turnsSinceEOTU=0));for(let o=0;o<this._nodes.length;o++)this._nodes[o].updateQuantumStatus(this._quantumLocation)}onQuantumEntanglement(){super.onQuantumEntanglement(),d.ship.currentSector==this&&d.ship.currentSector.removeActor(d.ship)}getQuantumLocation(){return this._quantumLocation}allowTelescope(){return!1}drawSectorBackdrop(){stroke(300,50,100),fill(0,0,0),ellipse(0,0,300,300)}removeActor(t){super.removeActor(t),t.lastSector=null}},Me=class extends O{load(){this._name="The Thing Older Than The Universe",this.loadFromJSON("data/sectors/eye_of_the_universe.json")}allowTelescope(){return!1}drawSectorBackdrop(){}};var Re=class{constructor(){u.addObserver(this),m("Solar System loading..."),this._sectorList=new Array,this._sectorList.push(this.comet=new Te),this._sectorList.push(this.rockyTwin=new Ee),this._sectorList.push(this.sandyTwin=new Pe),this._sectorList.push(this.timberHearth=new Ae),this._sectorList.push(this.brittleHollow=new ke),this._sectorList.push(this.giantsDeep=new Ce),this._sectorList.push(this.darkBramble=new De),this._sectorList.push(this.quantumMoon=new Le),this._sectorList.push(this.eyeOfTheUniverse=new Me),this.comet.load(),this.rockyTwin.load(),this.sandyTwin.load(),this.timberHearth.load(),this.brittleHollow.load(),this.giantsDeep.load(),this.darkBramble.load(),this.quantumMoon.load(),this.eyeOfTheUniverse.load(),this.player=new Q,this.ship=new Y(this.player)}onReceiveGlobalMessage(e){if(e.id==="spawn ship"){this.timberHearth.addActor(this.ship,"Village");let t=this.player.currentNode;this.timberHearth.removeActor(this.player),this.timberHearth.addActor(this.player,t)}else if(e.id==="move to"){let t=this.getNodeByName(e.text);this.player.moveToNode(t),t.shipAccess&&this.ship.moveToNode(t),n.clear(),n.publish("you reach "+t.getDescription())}else if(e.id==="teleport to")for(let t=0;t<this._sectorList.length;t++){let o=this._sectorList[t].getNode(e.text);o!=null&&(this.player.currentSector.removeActor(this.player),this._sectorList[t].addActor(this.player,o),i.loadSector(this._sectorList[t]),n.clear(),n.publish("you are teleported to "+o.getDescription()))}else e.id==="quantum moon vanished"&&(this.player.currentSector.removeActor(this.player),this.ship.currentSector.removeActor(this.ship),i.loadSolarSystemMap())}isPlayerInShip(){return this.player.currentNode===this.ship.currentNode}getNodeByName(e){for(let t=0;t<this._sectorList.length;t++){let o=this._sectorList[t].getNode(e);if(o!=null)return o}return null}getSectorByName(e){switch(e){case 7:return this.comet;case 1:return this.rockyTwin;case 2:return this.sandyTwin;case 3:return this.timberHearth;case 4:return this.brittleHollow;case 5:return this.giantsDeep;case 6:return this.darkBramble;case 8:return this.quantumMoon;case 9:return this.eyeOfTheUniverse;default:break}return null}};var D=class extends l{constructor(e,t,o,r,a,p){super(e,t,o,r,a),this.node=new f(t,o),this._sector=p}getRadius(){return this._bounds.y*.5}getSector(){return this._sector}render(){this.drawNonHighlighted(),this.hoverState&&strokeWeight(2),this.drawPlanet(),this.drawYouAreHere(),strokeWeight(1)}drawNonHighlighted(){}drawName(e,t){fill(0,0,100),textAlign(CENTER,CENTER),textSize(18),text(e??this.id,t??this.screenPosition.x,this.screenPosition.y-this.getRadius()-40)}drawYouAreHere(){d.ship.currentSector==this._sector&&d.ship.drawAt(this.screenPosition.x,this.screenPosition.y,.5,!0),d.player.currentSector==this._sector&&d.player.drawAt(this.screenPosition.x,this.screenPosition.y,.5)}drawZoomPrompt(){textSize(14),textFont(P),fill(0,0,0),stroke(0,0,100),rectMode(CENTER),rect(this.screenPosition.x,this.screenPosition.y+this.getRadius()+40,textWidth("L - Zoom In")+10,20),fill(0,0,100),textAlign(CENTER,CENTER),text("L - Zoom In",this.screenPosition.x,this.screenPosition.y+this.getRadius()+40)}},Ie=class extends D{constructor(e,t,o){super("The Comet",e,t,40,40,o)}drawPlanet(){noStroke(),fill(0,0,0),push(),translate(this.screenPosition.x,this.screenPosition.y),triangle(0,this.getRadius(),0,-this.getRadius(),130,0),stroke(200,30,100),arc(0,0,this._bounds.y,this._bounds.y,PI*.5,PI*1.5),line(0,this._bounds.y*.5,130,0),line(0,-this._bounds.y*.5,130,0),pop()}},G=class extends D{constructor(t,o,r,a){super("Hourglass Twin",t,o,50,50,a);this._isRightTwin=!1;this._isRightTwin=r,this._centerX=t,r?(this._twinName="Sandy ",this.setPosition(t+35,this.position.y)):(this._twinName="Rocky ",this.setPosition(t-35,this.position.y))}drawName(){super.drawName(this._twinName+this.id,this._centerX)}drawNonHighlighted(){this._isRightTwin||(stroke(60,100,100),fill(0,0,0),rectMode(CENTER),rect(this._centerX,this.position.y,this._bounds.y*1.5,this._bounds.y*.2))}drawPlanet(){stroke(60,100,100),fill(0,0,0),ellipse(this.position.x,this.position.y,this._bounds.y,this._bounds.y)}},We=class extends D{constructor(e,t,o){super("Timber Hearth",e,t,80,80,o)}drawPlanet(){stroke(200,100,100),fill(0,0,0),ellipse(this.position.x,this.position.y,this._bounds.x,this._bounds.y)}},Fe=class extends D{constructor(e,t,o){super("Brittle Hollow",e,t,80,80,o)}drawPlanet(){stroke(0,100,100),fill(0,0,0),ellipse(this.position.x,this.position.y,this._bounds.x,this._bounds.y)}},je=class extends D{constructor(e,t,o){super("Giant's Deep",e,t,150,150,o)}drawPlanet(){stroke(180,100,100),fill(0,0,0),ellipse(this.position.x,this.position.y,this._bounds.x,this._bounds.y)}},Je=class extends D{constructor(e,t,o){super("Dark Bramble",e,t,230,230,o)}drawPlanet(){stroke(120,100,100),fill(0,0,0),ellipse(this.position.x,this.position.y,this._bounds.x,this._bounds.y)}},He=class extends D{constructor(e,t){super("Quantum Moon",0,0,30,30,t),this._targets=e}collapse(){this._sector.collapse(),this.updatePosition()}updatePosition(){let e=this._sector.getQuantumLocation();m(e),e==4?this._currentTarget=null:this._currentTarget=this._targets[e],this._currentTarget!=null?this.setPosition(this._currentTarget.position.x-25,this._currentTarget.position.y-this._currentTarget.getRadius()-30):this.setPosition(-1e3,-1e3)}drawPlanet(){stroke(300,50,100),fill(0,0,0),ellipse(this.position.x,this.position.y,this._bounds.x,this._bounds.y)}};var Ue=class extends g{constructor(e){super(),this._solarSystem=e,this._player=e.player,this._ship=e.ship,this._sectorButtons=new Array;let t=height/2;this._sectorButtons.push(this._hourglassButton_left=new G(170,t,!1,this._solarSystem.rockyTwin)),this._sectorButtons.push(this._hourglassButton_right=new G(170,t,!0,this._solarSystem.sandyTwin)),this._sectorButtons.push(this._timberButton=new We(300,t,this._solarSystem.timberHearth)),this._sectorButtons.push(this._brittleButton=new Fe(420,t,this._solarSystem.brittleHollow)),this._sectorButtons.push(this._giantsButton=new je(580,t,this._solarSystem.giantsDeep)),this._sectorButtons.push(this._darkButton=new Je(810,t,this._solarSystem.darkBramble)),this._sectorButtons.push(this._cometButton=new Ie(600,t+200,this._solarSystem.comet));let o=[this._hourglassButton_right,this._timberButton,this._brittleButton,this._giantsButton];this._sectorButtons.push(this._quantumButton=new He(o,this._solarSystem.quantumMoon));for(let r=0;r<this._sectorButtons.length;r++)this.addButton(this._sectorButtons[r])}onEnter(){this._quantumButton.collapse()}update(){}render(){stroke(40,100,100),fill(0,0,0),ellipse(-430,height/2,1e3,1e3),this._ship.currentSector==null&&this._ship.render(),this._player.currentSector==null&&this._player.render()}onButtonEnterHover(e){this._sectorButtons.includes(e)&&(this._focusSectorButton=e)}onButtonExitHover(e){e===this._focusSectorButton&&(this._focusSectorButton=null)}onButtonUp(e){this._sectorButtons.includes(e)&&this.selectSector(e.getSector())}selectSector(e){}getSectorScreenPosition(e){for(let t=0;t<this._sectorButtons.length;t++)if(this._sectorButtons[t].getSector()==e)return this._sectorButtons[t].screenPosition;return null}},qe=class extends Ue{constructor(e,t){super(e),this.addButton(this._nextFrequency=new M(!0)),this.addButton(this._previousFrequency=new M(!1)),this.addButtonToToolbar(this._exitButton=new l("Exit",0,0,150,50)),this._telescope=t}onEnter(){super.onEnter(),noCursor(),this._signalSources=new Array,this._signalSources.push(new w(this._cometButton.screenPosition,this._cometButton.getSector())),this._signalSources.push(new w(this._hourglassButton_left.screenPosition,this._hourglassButton_left.getSector())),this._signalSources.push(new w(this._timberButton.screenPosition,this._timberButton.getSector())),this._signalSources.push(new w(this._brittleButton.screenPosition,this._brittleButton.getSector())),this._signalSources.push(new w(this._giantsButton.screenPosition,this._giantsButton.getSector())),this._signalSources.push(new w(this._darkButton.screenPosition,this._darkButton.getSector())),this._signalSources.push(new w(this._quantumButton.screenPosition,this._quantumButton.getSector()))}onExit(){cursor(HAND)}update(){super.update(),this._telescope.update(this._signalSources)}render(){super.render(),this._telescope.render(),this._focusSectorButton!=null&&this._focusSectorButton.drawName(),this._focusSectorButton!=null&&this._focusSectorButton.drawZoomPrompt()}selectSector(e){i.loadSectorTelescopeView(e)}onButtonUp(e){super.onButtonUp(e),e==this._exitButton?i.popScreen():e==this._nextFrequency?this._telescope.nextFrequency():e==this._previousFrequency&&this._telescope.previousFrequency()}},Ve=class extends Ue{constructor(e){super(e),this.addButtonToToolbar(this._databaseButton=new l("View Database",0,0,150,50)),this.addButtonToToolbar(this._telescopeButton=new l("Scan For Signals",0,0,150,50))}render(){super.render(),this._focusSectorButton!=null&&this._focusSectorButton.drawName(),n.render(),_.renderTimer()}onEnter(){super.onEnter(),this.setActorPosition(this._player),this.setActorPosition(this._ship)}setActorPosition(e){let t=new h(200,height-200);e.lastSector!=null?e.setScreenPosition(this.getSectorScreenPosition(e.lastSector)):e.setScreenPosition(t),e.moveToScreenPosition(t),e.lastSector=null}update(){this._player.update(),this._ship.update()}onButtonUp(e){e==this._databaseButton?i.pushScreen(i.databaseScreen):e==this._telescopeButton&&i.loadTelescopeView(),super.onButtonUp(e)}selectSector(e){let t=e;this._solarSystem.ship.currentSector==null&&t.addActor(this._solarSystem.ship),this._solarSystem.player.currentSector==null&&t.addActor(this._solarSystem.player),i.loadSector(t),t.onArrival()}};var Ge=class s extends g{constructor(){super();this.initTime=0;this.collapsePercent=0;this.supernovaPercent=0}static{this.SUN_SIZE=300}static{this.COLLAPSE_DURATION=2e3}static{this.SUPERNOVA_SIZE=2e3}static{this.SUPERNOVA_DURATION=2e3}onEnter(){this.initTime=millis(),this.collapseTime=this.initTime+1*500,this.supernovaTime=this.collapseTime+s.COLLAPSE_DURATION,n.clear(),n.publish("the sun is going supernova!",!0)}onExit(){}update(){this.collapsePercent=constrain((millis()-this.collapseTime)/s.COLLAPSE_DURATION,0,1),this.collapsePercent=this.collapsePercent*this.collapsePercent*this.collapsePercent,this.supernovaPercent=constrain((millis()-this.supernovaTime)/s.SUPERNOVA_DURATION,0,1),this.supernovaPercent=this.supernovaPercent*this.supernovaPercent,this.supernovaPercent==1&&c.killPlayer()}render(){push(),translate(width/2,height/2),noStroke(),fill(300*this.supernovaPercent,100,100),ellipse(0,0,5+s.SUPERNOVA_SIZE*this.supernovaPercent,5+s.SUPERNOVA_SIZE*this.supernovaPercent*(1-this.supernovaPercent*.5)),this.collapsePercent<1&&(stroke(40,100,100),fill(0,0,0),ellipse(0,0,s.SUN_SIZE*(1-this.collapsePercent),s.SUN_SIZE*(1-this.collapsePercent))),pop(),n.render()}onButtonUp(t){}},ze=class s extends g{constructor(){super();this.initTime=0;this.lastSpawnTime=0;this.flashbackPercent=0;this._ringSizes=new Array}static{this.FLASHBACK_DURATION=2200}onEnter(){this.initTime=millis(),n.clear(),n.publish("?!gnineppah s'tahW",!0)}onExit(){}update(){millis()-this.lastSpawnTime>50&&random(1)>.3&&(this.lastSpawnTime=millis(),this._ringSizes.push(5));for(let t=0;t<this._ringSizes.length;t++)this._ringSizes[t]=this._ringSizes[t]+this._ringSizes[t]*.1+.5;this.getFlashBackPercent()==1&&i.resetTimeLoop()}getFlashBackPercent(){return constrain((millis()-this.initTime)/s.FLASHBACK_DURATION,0,1)}render(){push(),translate(width/2,height/2);for(let o=0;o<this._ringSizes.length;o++)stroke(0,0,100),noFill(),ellipse(0,0,this._ringSizes[o],this._ringSizes[o]);pop();let t=constrain((this.getFlashBackPercent()-.9)/.1,0,1);fill(0,0,100,t*100),rectMode(CORNER),rect(0,0,width,height),n.render()}onButtonUp(t){}},Qe=class extends g{constructor(){super(),this.addButtonToToolbar(new l("Try Again"))}update(){}render(){fill(0,90,90),textAlign(CENTER,CENTER),textSize(100),text("You Are Dead",width/2,height/2)}onButtonUp(e){i.resetTimeLoop()}};var Ye=class extends _e{constructor(){super(...arguments);this._flashbackTriggered=!1}newGame(){this.setupSolarSystem(),this.titleScreen=new te,this.databaseScreen=new X,this.pushScreen(this.titleScreen)}resetTimeLoop(){this._flashbackTriggered=!1,this._screenStack.length=0,this.setupSolarSystem(),this.loadSector(3)}setupSolarSystem(){u.removeAllObservers(),u.addObserver(this),n.init(),_.init(),c.init(),this._telescope=new fe,this._solarSystem=new Re,this._solarSystem.timberHearth.addActor(this._solarSystem.player,"Village"),this.solarSystemMapScreen=new Ve(this._solarSystem),c.knowsLaunchCodes()&&u.sendMessage("spawn ship"),ft()}lateUpdate(){_.lateUpdate(),c.isPlayerDead()&&!this._flashbackTriggered&&(this._flashbackTriggered=!0,_.getEnabled()?this.swapScreen(new ze):this.swapScreen(new Qe))}onReceiveGlobalMessage(t){t.id==="death by anglerfish"?this.pushScreen(new se):t.id==="dive attempt"?this.pushScreen(new ie):t.id==="follow the vine"?this.swapScreen(new he):t.id==="explore ancient vessel"?this.swapScreen(new ce):t.id==="time loop central"?this.swapScreen(new de):t.id==="older than the universe"?this.swapScreen(new pe):t.id==="explore bramble outskirts"&&this.swapScreen(new me)}loadTelescopeView(){this.pushScreen(new qe(this._solarSystem,this._telescope))}loadSectorTelescopeView(t){this.pushScreen(new Ne(t,this._telescope))}loadSolarSystemMap(){this.swapScreen(this.solarSystemMapScreen)}loadSector(t){let o=t instanceof O?t:this._solarSystem.getSectorByName(t);this.swapScreen(new Oe(o,this._solarSystem.player,this._solarSystem.ship))}};var Ke=class{constructor(){this.player=i._solarSystem.player,this.ship=i._solarSystem.ship,this._quantumSector=i._solarSystem.quantumMoon}getQuantumMoonLocation(){return this._quantumSector.getQuantumLocation()}};var Xe=class s{static{this.MAX_LINES=3}init(){this._feed=new Array,u.addObserver(this)}clear(){this._feed.length=0}onReceiveGlobalMessage(e){}async publish(e,t=!1){let r=await A.getInstance().translate(e),a=`${e}
[\u8BD1: ${r}]`;this._feed.push(new nt(a,t)),this._feed.length>s.MAX_LINES&&this._feed.splice(0,1)}render(){for(let e=0;e<this._feed.length&&this._feed[e].draw(20,30+e*45);e++);}},nt=class s{constructor(e,t){this._displayTriggered=!1;this._lineColor=color(0,0,100);this._line=e,t&&(this._lineColor=color(100,100,100))}static{this.SPEED=.08}draw(e,t){this._displayTriggered||(this._initTime=millis(),this._displayTriggered=!0),textAlign(LEFT),fill(this._lineColor);let o=this._line.split(`
`),r=t;for(let a=0;a<o.length;a++){let p=o[a];a===0?(textFont(S),textSize(18)):(textFont("SimSun",16),e+=10,r+=5),text(p.substring(0,min(p.length,this.getDisplayLength())),e,r),r+=20,a>0&&(e-=10)}return textFont(P),this._line.length<=this.getDisplayLength()}getDisplayLength(){return int((millis()-this._initTime)*s.SPEED)}};var Ze=class s{static{this.ACTION_POINTS_PER_LOOP=15}init(){this._actionPoints=s.ACTION_POINTS_PER_LOOP,this._isTimeLoopEnabled=!0,this._triggerSupernova=!1,n.publish("You wake up next to a campfire near your village's launch tower. Today's the big day!"),n.publish("In the sky, you notice a bright object flying away from Giant's Deep...",!0),u.addObserver(this)}onReceiveGlobalMessage(e){e.id==="disable time loop"&&this._isTimeLoopEnabled&&(this._isTimeLoopEnabled=!1,n.publish("you disable the time loop device",!0))}lateUpdate(){this._triggerSupernova&&(this._triggerSupernova=!1,i.swapScreen(new Ge))}getEnabled(){return this._isTimeLoopEnabled}getLoopPercent(){return(s.ACTION_POINTS_PER_LOOP-this._actionPoints)/s.ACTION_POINTS_PER_LOOP}getActionPoints(){return this._actionPoints}waitFor(e){n.publish("you chill out for 1 minute",!0),this.spendActionPoints(e)}spendActionPoints(e){if(c.isPlayerAtEOTU())return;let t=this._actionPoints;this._actionPoints=max(0,this._actionPoints-e),u.sendMessage("action points spent"),t>s.ACTION_POINTS_PER_LOOP*.25&&this._actionPoints<=s.ACTION_POINTS_PER_LOOP*.25&&n.publish("you notice the Sun is getting awfully big and red",!0),this._actionPoints==0&&(this._triggerSupernova=!0)}renderTimer(){if(c.isPlayerAtEOTU())return;let e=50,t=50,o=height-50;stroke(0,0,100),fill(0,0,0),ellipse(t,o,e,e),fill(30,100,100),arc(t,o,e,e,0-PI*.5+TAU*this.getLoopPercent(),1.5*PI)}};var st=14,d,i,_,u,n,c,tt,Nt,R=!1,gt=!1,ct=!1,dt=!1,pt=!1,mt=!1,bt,wt,P,S;window.preload=function(){P=loadFont("data/fonts/Inconsolata.ttf"),S=loadFont("data/fonts/Inconsolata.ttf"),lt("data/audio/ow_kazoo_theme.mp3"),E("data/sectors/brittle_hollow.json"),E("data/sectors/comet.json"),E("data/sectors/dark_bramble.json"),E("data/sectors/eye_of_the_universe.json"),E("data/sectors/giants_deep.json"),E("data/sectors/quantum_moon.json"),E("data/sectors/rocky_twin.json"),E("data/sectors/sandy_twin.json"),E("data/sectors/timber_hearth.json")};window.setup=function(){let e=document.getElementById("game-canvas");createCanvas(1440,1080,null,e),pixelDensity(2),e.style.removeProperty("width"),e.style.removeProperty("height"),e.style.imageRendering="auto",e.oncontextmenu=()=>!1,e.ontouchstart=o=>{mouseButton=o.touches.length===2?RIGHT:LEFT};let t=document.getElementById("full-screen-button");t.onclick=()=>{document.fullscreenElement?document.exitFullscreen():document.documentElement.requestFullscreen()},noSmooth(),colorMode(HSB,360,100,100,100),rectMode(CENTER),ellipseMode(CENTER),it(),tt=new z,Bt()};function Bt(){let s=millis();_=new Ze,Nt=new k,u=new Z,n=new Xe,i=new Ye,c=N.loadData(),i.newGame(),m("Load time:",millis()-s)}window.draw=function(){i.runGameLoop(),wt=millis()-bt,bt=millis()};function ee(s){switch(s){case 2:return"Traveler Frequency";case 0:return"Distress Beacon";case 1:return"Quantum Fluctuations";default:return""}}function ft(){d=new Ke}function it(){textSize(14),textFont(P)}function tn(){textSize(18),textFont(S)}})();
//# sourceMappingURL=bundle.js.map
